<!doctype html>
<html lang="es">
<head>
    <!-- ===================== BASIC META ===================== -->
    <meta charset="utf-8" /> <!-- Enables √±, accents, emojis -->
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="theme-color" content="#0b0b10" />
    <title>Feliz Cumple ‚ù§Ô∏è</title>

    <style>
        /* =========================================================
           0) GLOBAL THEME (change these to change the whole look)
           ========================================================= */
        :root{
            --bg:#0b0b10;                      /* Base background */
            --text: rgba(255,255,255,.92);     /* Primary text color */
            --muted: rgba(255,255,255,.72);    /* Secondary text color */
            --shadow: 0 18px 60px rgba(0,0,0,.55);
            --radius: 22px;

            /* Safe areas for iPhone notch */
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        *{ box-sizing:border-box; }
        html,body{ height:100%; margin:0; background:var(--bg); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
        body{ overflow:hidden; } /* Only the slides container scrolls */

        /* =========================================================
           1) APP FRAME (phone-like on desktop)
           ========================================================= */
        .app{
            height: 100vh;
            width: 100vw;
            max-width: 440px;
            margin: 0 auto;
            position: relative;
            background: radial-gradient(1200px 800px at 50% 0%, rgba(255,255,255,.08), transparent 60%), var(--bg);
            overflow:hidden;
        }

        /* =========================================================
           2) INTRO OVERLAY (7 texts, one every 2 seconds)
           ========================================================= */
        .intro{
            position:absolute;
            inset:0;
            z-index: 100;
            display:flex;
            align-items:center;
            justify-content:center;
            padding: calc(18px + var(--safe-top)) 16px calc(18px + var(--safe-bottom));
            background:
                    radial-gradient(900px 700px at 30% 30%, rgba(255,75,92,.28), transparent 60%),
                    radial-gradient(900px 700px at 70% 70%, rgba(120,220,255,.18), transparent 60%),
                    linear-gradient(135deg, #09090f, #0b0b10);
            transition: opacity .45s ease, transform .45s ease;
        }
        .intro.hidden{
            opacity: 0;
            transform: scale(1.02);
            pointer-events:none;
        }

        /* Wrapper to let the heart sit outside the card */
        .introWrap{
            position: relative;
            width: 100%;
            max-width: 390px; /* same width as introCard */
        }

        /* Floating heart outside the box */
        .introHeart{
            position: absolute;
            top: -220px;              /* move up/down */
            left: 50%;
            transform: translateX(-50%);
            width: 140px;
            height: 60px;
            border-radius: 999px;

            display: grid;
            place-items: center;

            background: linear-gradient(135deg, rgba(255,75,92,.95), rgba(255,255,255,.25));
            box-shadow: 0 12px 30px rgba(0,0,0,.45);
            border: 1px solid rgba(255,255,255,.18);

            font-size: 20px;
            user-select:none;
        }

        .introCard{
            width: 100%;
            max-width: 790px;
            border-radius: 288px;
            background: rgba(255,255,255,.09);
            border: 1px solid rgba(255,255,255,.12);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(3px);
            box-shadow: var(--shadow);
            padding: 48px 56px 48px; /* extra top padding so content doesn't clash with heart */
            text-align:center;
        }

        .brand{
            display:flex;
            align-items:center;
            gap:10px;
            user-select:none;
        }

        /* Fixed avatar: center emoji properly */
        .avatar{
            width: 37px; height: 37px;
            border-radius: 999px;
            background: linear-gradient(400deg, rgba(255,75,92,.95), rgba(255,255,255,.25));
            box-shadow: 0 5px 22px rgba(0,0,0,.35);
            font-size: 20px;

            display: grid;
            place-items: center;
            user-select: none;
        }

        .introText{
            font-size: 50px;
            line-height: 1.05;
            letter-spacing: -0.3px;
            margin: 5px 0 8px;
            text-shadow: 0 16px 50px rgba(0,0,0,.55);
            min-height: 44px;
            opacity: 0;
            transform: translateY(6px);
            transition: opacity .35s ease, transform .35s ease;
        }
        .introText.show{
            opacity: 1;
            transform: translateY(0);
        }

        .introHint{
            margin-top: 16px;
            font-size: 12.5px;
            color: rgba(255,255,255,.74);
            display:flex;
            justify-content:center;
            gap: 8px;
            user-select:none;
        }
        .dotPulse{
            width: 6px; height: 6px; border-radius: 999px;
            background: rgba(255,255,255,.88);
            box-shadow: 0 0 0 6px rgba(255,255,255,.10);
            animation: pulse 1.1s infinite ease-in-out;
        }
        @keyframes pulse{
            0%,100%{ transform: scale(1); opacity:.9; }
            50%{ transform: scale(1.25); opacity:.65; }
        }

        /* =========================================================
           3) TOP BAR (progress + title + buttons)
           ========================================================= */
        .topbar{
            position:absolute;
            inset: 0 0 auto 0;
            z-index: 30;
            padding: calc(12px + var(--safe-top)) 14px 10px;
            display:flex;
            flex-direction: column;
            gap: 10px;
            pointer-events:none; /* only headerRow is clickable */
        }

        .progress{
            display:grid;
            grid-template-columns: repeat(10, 1fr); /* 10 slides */
            gap: 6px;
            padding: 10px 10px;
            border-radius: 999px;
            background: rgba(0,0,0,.28);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 10px 30px rgba(0,0,0,.30);
        }
        .seg{
            height: 4px;
            border-radius: 999px;
            background: rgba(255,255,255,.20);
            overflow:hidden;
            position:relative;
        }
        .seg > i{
            position:absolute; inset:0;
            transform: scaleX(0);
            transform-origin: left;
            background: rgba(255,255,255,.92);
            border-radius: 999px;
        }

        .headerRow{
            display:flex;
            align-items:center;
            justify-content: space-between;
            gap: 10px;
            padding: 0 2px;
            pointer-events:auto; /* buttons clickable */
        }
        .pill{
            display:flex;
            align-items:center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 999px;
            background: rgba(255,255,255,.10);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            box-shadow: 0 10px 30px rgba(0,0,0,.30);
            border: 1px solid rgba(255,255,255,.10);
            user-select:none;
        }
        .titleWrap{ line-height:1.05; }
        .titleWrap b{ font-size: 13px; letter-spacing:.2px; }
        .titleWrap span{ display:block; font-size: 11.5px; color: var(--muted); margin-top: 2px; }

        .actions{ display:flex; gap: 10px; }
        .iconBtn{
            width: 42px; height: 42px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,.12);
            background: rgba(255,255,255,.10);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            display:grid; place-items:center;
            box-shadow: 0 10px 30px rgba(0,0,0,.28);
            cursor:pointer;
            transition: transform .12s ease, background .2s ease;
        }
        .iconBtn:active{ transform: scale(.96); }
        .iconBtn svg{ width: 18px; height: 18px; opacity: .92; }

        /* =========================================================
           4) SLIDES CONTAINER (vertical snap)
           ========================================================= */
        .slides{
            position:absolute;
            inset:0;
            overflow-y:auto;
            scroll-snap-type: y mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            pointer-events:auto;
        }
        .slides::-webkit-scrollbar{ display:none; }
        .slides.locked{ overflow:hidden; pointer-events:none; } /* locked during intro */

        .slide{
            height: 100vh;
            width: 100%;
            scroll-snap-align: start;
            position: relative;
            overflow:hidden;
            background:#000;
            display:flex;
            align-items:flex-end;
            justify-content:center;
            padding: calc(16px + var(--safe-top) + 84px) 14px calc(16px + var(--safe-bottom) + 82px);
        }

        /* Full-bleed background image */
        .photo{
            position:absolute;
            inset:0;
            width:100%;
            height:100%;
            object-fit: cover;
            transform: scale(1.03);
            filter: contrast(1.03) saturate(1.07);
            background:#000;
        }

        /* Full-bleed background video (same role as .photo) */
        .video{
            position:absolute;
            inset:0;
            width:100%;
            height:100%;
            object-fit: cover;
            background:#000;
        }

        /* Dark gradient for text readability */
        .vignette{
            position:absolute; inset:0;
            background:
                    radial-gradient(900px 650px at 50% 10%, rgba(255,255,255,.08), transparent 60%),
                    linear-gradient(to top,
                    rgba(0,0,0,.86) 0%,
                    rgba(0,0,0,.48) 32%,
                    rgba(0,0,0,.18) 60%,
                    rgba(0,0,0,.04) 100%);
            pointer-events:none;
        }

        /* Decorative glow */
        .accent{
            position:absolute;
            width: 420px; height: 420px;
            left: -140px; top: 45%;
            background: radial-gradient(circle at 30% 30%, rgba(255,75,92,.42), transparent 60%),
            radial-gradient(circle at 70% 70%, rgba(120,220,255,.28), transparent 60%);
            filter: blur(22px);
            opacity: .85;
            transform: translateZ(0);
            pointer-events:none;
        }

        /* Caption card */
        .card{
            position:relative;
            z-index: 10;
            width: 100%;
            max-width: 400px;
            border-radius: var(--radius);
            background: rgba(255,255,255,.10);
            backdrop-filter: blur(7px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255,255,255,.12);
            box-shadow: var(--shadow);
            padding: 11px 11px 11px;
            transform: translateY(12px);
            opacity: 0;
            transition: transform .55s cubic-bezier(.2,.9,.2,1), opacity .55s ease;
        }
        .slide.active .card{ transform: translateY(0); opacity: 1; }

        .badge{
            display:inline-flex;
            align-items:center;
            gap: 8px;
            padding: 8px 10px;
            border-radius: 999px;
            background: rgba(0,0,0,.22);
            border: 1px solid rgba(255,255,255,.12);
            font-size: 12px;
            letter-spacing: .2px;
            color: rgba(255,255,255,.90);
            margin-bottom: 10px;
        }
        .badge i{
            width: 8px; height: 8px; border-radius: 999px;
            background: rgba(255,255,255,.92);
            display:inline-block;
            box-shadow: 0 0 0 4px rgba(255,255,255,.12);
        }

        h1,h2{ margin:0 0 8px 0; line-height: 1.06; text-shadow: 0 14px 42px rgba(0,0,0,.55); }
        h1{ font-size: 32px; letter-spacing:-.2px; }
        h2{ font-size: 24px; letter-spacing:-.2px; color: rgba(255,255,255,.96); }

        p{ margin:0; font-size: 15.5px; line-height: 1.38; color: rgba(255,255,255,.88); text-shadow: 0 14px 42px rgba(0,0,0,.55); }

        /* =========================================================
           5) BOTTOM BAR (hint + prev/next buttons)
           ========================================================= */
        .bottombar{
            position:absolute;
            inset: auto 0 0 0;
            z-index: 35;
            padding: 10px 14px calc(12px + var(--safe-bottom));
            display:flex;
            align-items:center;
            justify-content: space-between;
            gap: 10px;
            pointer-events:auto;
        }

        .hint{
            padding: 10px 12px;
            border-radius: 999px;
            background: rgba(0,0,0,.28);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border: 1px solid rgba(255,255,255,.10);
            color: rgba(255,255,255,.82);
            font-size: 12.5px;
            display:flex;
            align-items:center;
            gap: 8px;
            user-select:none;
        }
        .hint .arrow{ display:inline-block; animation: bob 1.2s ease-in-out infinite; }
        @keyframes bob{ 0%,100%{ transform: translateY(0);} 50%{ transform: translateY(4px);} }

        .cta{ display:flex; gap: 10px; }
        .btn{
            padding: 12px 14px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,.14);
            background: rgba(255,255,255,.10);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            box-shadow: 0 12px 34px rgba(0,0,0,.35);
            color: rgba(255,255,255,.92);
            font-weight: 700;
            letter-spacing: .2px;
            cursor:pointer;
            transition: transform .12s ease, background .2s ease;
        }
        .btn:active{ transform: scale(.98); }
        .btn.primary{
            background: linear-gradient(135deg, rgba(255,75,92,.95), rgba(255,128,160,.78));
            border-color: rgba(255,255,255,.18);
        }

        /* Confetti canvas */
        canvas#fx{
            position:absolute;
            inset:0;
            z-index: 50;
            pointer-events:none;
        }
        /* ===================== SORPRESA OVERLAY ===================== */
        .surpriseOverlay{
            position:absolute;
            inset:0;
            z-index: 200; /* encima de todo */
            background: #000;
            display:flex;
            align-items:center;
            justify-content:center;

            opacity: 1;
            transform: scale(1);
            transition: opacity .35s ease, transform .35s ease;
        }

        .surpriseOverlay.hidden{
            opacity: 0;
            transform: scale(1.02);
            pointer-events:none;
        }

        /* Video vertical full screen */
        .surpriseVideo{
            position:absolute;
            inset:0;
            width:100%;
            height:100%;
            object-fit: cover;
            background:#000;
        }

        /* Bot√≥n cerrar arriba */
        .surpriseClose{
            position:absolute;
            top: calc(14px + var(--safe-top));
            right: 14px;
            z-index: 210;

            width: 44px;
            height: 44px;
            border-radius: 999px;

            border: 1px solid rgba(255,255,255,.18);
            background: rgba(0,0,0,.35);
            color: rgba(255,255,255,.92);

            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);

            font-size: 18px;
            font-weight: 900;
            cursor:pointer;
        }
        .surpriseClose:active{ transform: scale(.96); }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce){
            .card, .intro, .introText{ transition:none; }
            .hint .arrow, .dotPulse{ animation:none; }
            .slide.active .card{ opacity:1; transform:none; }
            .photo{ transform:none; }
        }
    </style>
</head>

<body>
<div class="app" role="application" aria-label="Slides de cumplea√±os">

    <!-- Confetti canvas (used in last slide button) -->
    <canvas id="fx" width="0" height="0" aria-hidden="true"></canvas>

    <!-- ===================== INTRO OVERLAY ===================== -->
    <div class="intro" id="intro">
        <div class="introWrap">
            <div class="introHeart">27.12.2025</div>

            <div class="introCard">
                <div class="introText" id="introText">HOLA</div>

                <div class="introHint">
                    <span class="dotPulse"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- ===================== TOP BAR ===================== -->
    <div class="topbar">
        <div class="progress" aria-label="Progreso" id="progress">
            <!-- 10 segments (one per slide) -->
            <div class="seg"><i></i></div><div class="seg"><i></i></div><div class="seg"><i></i></div><div class="seg"><i></i></div><div class="seg"><i></i></div>
            <div class="seg"><i></i></div><div class="seg"><i></i></div><div class="seg"><i></i></div><div class="seg"><i></i></div><div class="seg"><i></i></div>
        </div>

        <div class="headerRow">
            <div class="pill" aria-label="Cabecera">
                <div class="avatar">‚ù§Ô∏è</div>
                <div class="titleWrap">
                    <b>Feliz Cumple</b>
                    <span id="slideLabel"> 1 / 10</span>
                </div>
            </div>

            <div class="actions">
                


                <!-- Music toggle (needs music.mp3 in same folder) -->
                <button class="iconBtn" id="soundBtn" aria-label="M√∫sica (opcional)" title="M√∫sica (opcional)">
                    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M9 18V6l12-2v12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M9 20a2 2 0 1 1 0-4 2 2 0 0 1 0 4Z" stroke="currentColor" stroke-width="2"/>
                        <path d="M21 18a2 2 0 1 1 0-4 2 2 0 0 1 0 4Z" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- ===================== SLIDES ===================== -->
    <div class="slides locked" id="slides">

        <!-- SLIDE 1 (photo) -->
        <section class="slide">
            <img class="photo" src="photos/GUAPOS.jpg" alt="Foto 1" loading="eager" />
            <div class="accent"></div><div class="vignette"></div>
            <div class="card">
                <div class="badge"><i></i> Slide 1</div>
                <h1>Mi amor ‚ù§Ô∏è</h1>
                <p>Hoy celebro tu vida. Gracias por existir y por hacer mis d√≠as m√°s lindos.</p>
            </div>
        </section>

        <!-- SLIDE 2 (photo) -->
        <section class="slide">
            <img class="photo" src="foto2.jpg" alt="Foto 2" loading="lazy" />
            <div class="accent"></div><div class="vignette"></div>
            <div class="card">
                <div class="badge"><i></i> Slide 2</div>
                <h2>Ese d√≠a ‚ú®</h2>
                <p>Me encanta c√≥mo todo se siente m√°s f√°cil cuando est√°s cerca.</p>
            </div>
        </section>

        <!-- SLIDE 3 (photo) -->
        <section class="slide">
            <img class="photo" src="foto3.jpg" alt="Foto 3" loading="lazy" />
            <div class="accent"></div><div class="vignette"></div>
            <div class="card">
                <div class="badge"><i></i> Slide 3</div>
                <h2>Peque√±as cosas</h2>
                <p>Tu risa, tu forma de mirar, tus ocurrencias‚Ä¶ me tienen ganado.</p>
            </div>
        </section>

        <!-- SLIDE 4 (photo) -->
        <section class="slide">
            <img class="photo" src="foto4.jpg" alt="Foto 4" loading="lazy" />
            <div class="accent"></div><div class="vignette"></div>
            <div class="card">
                <div class="badge"><i></i> Slide 4</div>
                <h2>Eres incre√≠ble</h2>
                <p>Admiro tu coraz√≥n, tu esfuerzo y lo bonita que eres por dentro.</p>
            </div>
        </section>

        <!-- SLIDE 5 (photo) -->
        <section class="slide">
            <img class="photo" src="foto5.jpg" alt="Foto 5" loading="lazy" />
            <div class="accent"></div><div class="vignette"></div>
            <div class="card">
                <div class="badge"><i></i> Slide 5</div>
                <h2>Por ser t√∫</h2>
                <p>Gracias por acompa√±arme, por apoyarme y por hacer hogar donde estemos.</p>
            </div>
        </section>

        <!-- SLIDE 6 (photo) -->
        <section class="slide">
            <img class="photo" src="foto6.jpg" alt="Foto 6" loading="lazy" />
            <div class="accent"></div><div class="vignette"></div>
            <div class="card">
                <div class="badge"><i></i> Slide 6</div>
                <h2>Equipo</h2>
                <p>Contigo, la vida se siente como un plan bonito que s√≠ quiero vivir.</p>
            </div>
        </section>

        <!-- SLIDE 7 (video) -->
        <section class="slide video-slide">
            <video
                    class="video"
                    src="photos/ent.mp4"
                    playsinline
                    loop
                    preload="metadata">
            </video>

            <div class="accent"></div><div class="vignette"></div>
            <div class="card">
                <div class="badge"><i></i> Boxeadora </div>
                <h2>Tremenda izquierda</h2>
                <p>Aprendes rapido!</p>
            </div>
        </section>

        <!-- SLIDE 8 (video) -->
        <section class="slide video-slide">
            <video
                    class="video"
                    src="photos/gym.mp4"
                    playsinline
                    loop
                    preload="metadata">
                Tu navegador no soporta el elemento video.
            </video>

            <div class="accent"></div><div class="vignette"></div>
            <div class="card">
                <div class="badge"><i></i> GYM </div>
                <h2>Guaaaauu</h2>
                <p>Que fuerte esa ragazza</p>
            </div>
        </section>

        <!-- SLIDE 10 (photo + finale buttons) -->
        <section class="slide">
            <img class="photo" src="foto10.jpg" alt="Foto 10" loading="lazy" />
            <div class="accent"></div><div class="vignette"></div>
            <div class="card">
                <div class="badge"><i></i> Slide 10</div>
                <h1>Una √∫ltima cosa‚Ä¶</h1>
                <p>Si llegaste hasta aqu√≠‚Ä¶ es porque eres mi persona favorita. ‚ù§Ô∏è</p>
                <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
                    <button class="btn primary" id="loveBtn">üíò</button>
                    <button class="btn" id="surpriseBtn">Sorpresa</button>
                    <button class="btn" id="replayBtn">Inicio ‚Ü∫</button>
                </div>
            </div>
        </section>

    </div>

    <!-- ===================== BOTTOM BAR ===================== -->
    <div class="bottombar">
        <div class="hint"><span class="arrow">‚¨áÔ∏è</span> Desliza pa abajo </div>
        <div class="cta">
            <button class="btn" id="prevBtn">‚Üë</button>
            <button class="btn" id="nextBtn">‚Üì</button>
        </div>
    </div>
    <!-- ===================== OVERLAY SORPRESA (VIDEO) ===================== -->
    <div class="surpriseOverlay hidden" id="surpriseOverlay" aria-hidden="true">
        <video
                id="surpriseVideo"
                class="surpriseVideo"
                src="photos/ricardo.mp4"
                playsinline
                preload="auto">
            Tu navegador no soporta video.
        </video>

        <!-- Bot√≥n para cerrar manualmente (por si acaso) -->
        <button class="surpriseClose" id="surpriseClose" type="button">‚úï</button>
    </div>

    <!-- Optional background music: put song.mp3 next to index.html -->
    <audio id="music" src="song.mp3" preload="none"></audio>
</div>

<script>
    /* =========================================================
   SURPRISE VIDEO OVERLAY (open -> play -> auto close -> go to slide 1)
   ========================================================= */
    const surpriseBtn = document.getElementById("surpriseBtn");
    const surpriseOverlay = document.getElementById("surpriseOverlay");
    const surpriseVideo = document.getElementById("surpriseVideo");
    const surpriseClose = document.getElementById("surpriseClose");

    // Ajusta duraci√≥n m√°xima (por si el video no dispara "ended")
    const SURPRISE_MAX_MS = 12000; // 12s (c√°mbialo a lo que dure tu video)

    let surpriseTimer = null;

    function closeSurprise(){
        // Para el video
        try{
            surpriseVideo.pause();
            surpriseVideo.currentTime = 0;
        } catch(e){}

        // Oculta overlay
        surpriseOverlay.classList.add("hidden");
        surpriseOverlay.setAttribute("aria-hidden", "true");

        // Limpia timer
        if (surpriseTimer) {
            clearTimeout(surpriseTimer);
            surpriseTimer = null;
        }

        // Vuelve a la primera slide
        goTo(0);
    }

    function openSurprise(){
        // Muestra overlay
        surpriseOverlay.classList.remove("hidden");
        surpriseOverlay.setAttribute("aria-hidden", "false");

        // IMPORTANTE: en m√≥viles, audio autoplay puede bloquearse.
        // Si quieres audio s√≠ o s√≠, deja el video con controles o pide toque.
        surpriseVideo.muted = false; // intenta con audio
        surpriseVideo.currentTime = 0;

        // Reproduce
        surpriseVideo.play().catch(() => {
            // Si bloquea, lo dejamos en mute y reproducimos
            surpriseVideo.muted = true;
            surpriseVideo.play().catch(()=>{});
            toast("Toca el video para activar audio üîä");
        });

        // Auto-cierre por tiempo m√°ximo
        surpriseTimer = setTimeout(closeSurprise, SURPRISE_MAX_MS);
    }

    // Abrir con bot√≥n
    surpriseBtn?.addEventListener("click", openSurprise);

    // Cerrar manual con X
    surpriseClose?.addEventListener("click", closeSurprise);

    // Cerrar autom√°ticamente cuando termine el video
    surpriseVideo?.addEventListener("ended", closeSurprise);

    // Tip: tocar el video activa audio si estaba muteado
    surpriseVideo?.addEventListener("click", async () => {
        if (surpriseVideo.muted) {
            try{
                surpriseVideo.muted = false;
                await surpriseVideo.play();
                toast("Audio activado üîä");
            } catch(e){}
        }
    });

    /* =========================================================
       A) INTRO TEXT: 7 chunks, one every X seconds
       ========================================================= */
    const intro = document.getElementById("intro");
    const introText = document.getElementById("introText");
    const slidesEl = document.getElementById("slides");

    const introChunks = [
        "Scemina!",
        "Topolina...",
        "Tu Novio",
        "Te Desea",
        "Feliz",
        "Cumplea√±os ",
        "A ti ‚ù§Ô∏è"
    ];

    const chunkIntervalMs = 3000;

    let chunkIndex = 0;
    let introTimer = null;

    function showChunk(i){
        introText.classList.remove("show");
        setTimeout(() => {
            introText.textContent = introChunks[i];
            introText.classList.add("show");
        }, 120);
    }

    function finishIntro(){
        clearInterval(introTimer);
        intro.classList.add("hidden");
        slidesEl.classList.remove("locked");
        slidesEl.scrollTo({ top: 0, behavior: "instant" });
    }

    function startIntro(){
        showChunk(0);
        introTimer = setInterval(() => {
            chunkIndex++;
            if (chunkIndex < introChunks.length) showChunk(chunkIndex);
            else finishIntro();
        }, chunkIntervalMs);
    }

    /* =========================================================
       B) SLIDES ACTIVE STATE + PROGRESS
       ========================================================= */
    const slides = Array.from(document.querySelectorAll(".slide"));
    const segs = Array.from(document.querySelectorAll(".seg > i"));
    const slideLabel = document.getElementById("slideLabel");

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const replayBtn = document.getElementById("replayBtn");
    const loveBtn = document.getElementById("loveBtn");

    let activeIndex = 0;

    const io = new IntersectionObserver((entries) => {
        entries.forEach(e => {
            if (e.isIntersecting) {
                slides.forEach(s => s.classList.remove("active"));
                e.target.classList.add("active");
                activeIndex = slides.indexOf(e.target);
                updateUI(activeIndex);
            }
        });
    }, { root: slidesEl, threshold: 0.62 });

    slides.forEach(s => io.observe(s));

    function updateUI(idx){
        slideLabel.textContent = `Slide ${idx+1} de ${slides.length}`;
        segs.forEach((bar, i) => {
            bar.style.transform = (i <= idx) ? "scaleX(1)" : "scaleX(0)";
        });
    }

    function goTo(i){
        const clamped = Math.max(0, Math.min(slides.length - 1, i));
        slides[clamped].scrollIntoView({ behavior: "smooth", block: "start" });
    }

    prevBtn.addEventListener("click", () => goTo(activeIndex - 1));
    nextBtn.addEventListener("click", () => goTo(activeIndex + 1));
    replayBtn?.addEventListener("click", () => goTo(0));

    window.addEventListener("keydown", (e) => {
        if (e.key === "ArrowDown" || e.key === "PageDown") goTo(activeIndex + 1);
        if (e.key === "ArrowUp" || e.key === "PageUp") goTo(activeIndex - 1);
        if (e.key === "Home") goTo(0);
        if (e.key === "End") goTo(slides.length - 1);
    });

    /* =========================================================
       D) MUSIC TOGGLE
       ========================================================= */
    const soundBtn = document.getElementById("soundBtn");
    const music = document.getElementById("music");
    let playing = false;

    soundBtn.addEventListener("click", async () => {
        try{
            if (!playing) {
                music.volume = 0.35;
                await music.play();
                playing = true;
                toast("M√∫sica ON üéµ");
            } else {
                music.pause();
                playing = false;
                toast("M√∫sica OFF üîá");
            }
        } catch(e){
            toast("song.mp3");
        }
    });

    /* =========================================================
       E) TOAST
       ========================================================= */
    let toastTimer = null;
    function toast(msg){
        let el = document.getElementById("toast");
        if(!el){
            el = document.createElement("div");
            el.id = "toast";
            el.style.position = "absolute";
            el.style.left = "50%";
            el.style.bottom = "110px";
            el.style.transform = "translateX(-50%)";
            el.style.zIndex = "60";
            el.style.padding = "10px 12px";
            el.style.borderRadius = "999px";
            el.style.background = "rgba(0,0,0,.45)";
            el.style.border = "1px solid rgba(255,255,255,.12)";
            el.style.backdropFilter = "blur(14px)";
            el.style.webkitBackdropFilter = "blur(14px)";
            el.style.color = "rgba(255,255,255,.92)";
            el.style.fontSize = "12.5px";
            el.style.boxShadow = "0 16px 50px rgba(0,0,0,.45)";
            el.style.opacity = "0";
            el.style.transition = "opacity .18s ease, transform .18s ease";
            el.style.pointerEvents = "none";
            document.querySelector(".app").appendChild(el);
        }
        el.textContent = msg;
        el.style.opacity = "1";
        el.style.transform = "translateX(-50%) translateY(0)";
        clearTimeout(toastTimer);
        toastTimer = setTimeout(() => {
            el.style.opacity = "0";
            el.style.transform = "translateX(-50%) translateY(6px)";
        }, 1600);
    }

    /* =========================================================
       F) VIDEO: play when visible, pause when not
       ========================================================= */
    const storyVideos = Array.from(document.querySelectorAll(".video-slide .video"));

    const videoObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            const video = entry.target;
            if (entry.isIntersecting) {
                video.play().catch(() => {});
            } else {
                video.pause();
                video.currentTime = 0;
            }
        });
    }, { root: slidesEl, threshold: 0.6 });

    storyVideos.forEach(v => videoObserver.observe(v));

    /* =========================================================
       G) CONFETTI (last slide button)
       ========================================================= */
    const canvas = document.getElementById("fx");
    const ctx = canvas.getContext("2d");

    function resizeCanvas(){
        const rect = document.querySelector(".app").getBoundingClientRect();
        canvas.width = Math.floor(rect.width * devicePixelRatio);
        canvas.height = Math.floor(rect.height * devicePixelRatio);
        canvas.style.width = rect.width + "px";
        canvas.style.height = rect.height + "px";
        ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    let particles = [];
    function burst(){
        const rect = document.querySelector(".app").getBoundingClientRect();
        const x = rect.width/2, y = rect.height*0.35;
        const count = 160;

        for(let i=0;i<count;i++){
            particles.push({
                x, y,
                vx: (Math.random()*2-1) * (4 + Math.random()*5),
                vy: (Math.random()*-1) * (6 + Math.random()*7),
                g: 0.22 + Math.random()*0.10,
                r: 2 + Math.random()*3,
                life: 70 + Math.random()*30,
                t: 0,
                spin: (Math.random()*2-1) * 0.25,
                rot: Math.random()*Math.PI*2,
                c: ["#fff","#ffd1dc","#ff4b5c","#7fe6ff","#ffeaa7"][Math.floor(Math.random()*5)]
            });
        }
        if (navigator.vibrate) navigator.vibrate([20, 30, 20]);
        animate();
    }

    let animRunning = false;
    function animate(){
        if (animRunning) return;
        animRunning = true;

        const step = () => {
            ctx.clearRect(0,0,canvas.width,canvas.height);

            particles = particles.filter(p => p.t < p.life);
            for(const p of particles){
                p.t += 1;
                p.vy += p.g;
                p.x += p.vx;
                p.y += p.vy;
                p.rot += p.spin;

                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.rot);
                ctx.globalAlpha = Math.max(0, 1 - (p.t / p.life));
                ctx.fillStyle = p.c;
                ctx.fillRect(-p.r, -p.r, p.r*2.2, p.r*2.2);
                ctx.restore();
            }

            if (particles.length > 0) requestAnimationFrame(step);
            else animRunning = false;
        };
        requestAnimationFrame(step);
    }

    loveBtn?.addEventListener("click", () => {
        burst();
        toast("TE AMO ‚ù§Ô∏è");
    });

    /* =========================================================
       H) INIT
       ========================================================= */
    slides[0].classList.add("active");
    updateUI(0);
    startIntro();
</script>
</body>
</html>
